<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Elasticsearch Workshop</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

        <style>
            .background-image-overlay {
                background: black !important;
                padding: 10px;
                opacity: 0.8;
            }
        </style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Elasticsearch Workshop</h1>
					<h3>2016</h3>
                    <aside class="notes">
                        ENG:
                        <ul>
                            <li>
                                Hi everyone... nice to see that so many could be here today...
                            </li>
                            <li>
                                My name is Eirik and this is Magne...
                            </li>
                            <li>
                                We will start the Elasticsearch workshop with an presentation...
                            </li>
                            <li>
                                The presentation will last about one hour... after that we will start with workshop tasks...
                            </li>
                            <li>
                                We'll go around and help with software installation after the presentation...
                            </li>
                            <li>
                                Feel free to ask questions during the presentation...
                            </li>
                        </ul>
                        NOR:
                        <ul>
                            <li>
                                Velkommen, i dag skal vi holde en Elasticsearch workshop.
                            </li>
                            <li>
                                Vi vil begynne workshopen med en presentasjon
                            </li>
                            <li>
                                Presentasjonen vil vare i sirka en time... deretter vil vi starte med workshop oppgaver...
                            </li>
                            <li>
                                Vi vil gå rundt å hjelpe med programvare installasjon etter presentasjonen...
                            </li>
                            <li>
                                Gjerne still spørsmål under presentasjonen...
                            </li>
                        </ul>
                    </aside>
				</section>

				<section>
            <h2>Agenda</h2>
            <ul>
                <li class="fragment">How does a search engine work</li>
                <li class="fragment">Elasticsearch
                    <ul>
                        <li class="fragment">What is</li>
                        <li class="fragment">Use cases</li>
						<li class="fragment">Own experience</li>
                        <li class="fragment">How to get started</li>
						<li class="fragment">Mapping</li>
						<li class="fragment">Queries and filters</li>
						<li class="fragment">Aggregations</li>
						<li class="fragment">Highlighting</li>
                    </ul>
                </li>
                <li class="fragment">Workshop</li>
            </ul>
            <aside class="notes">
                ENG:
                <ul>
                    <li>The agenda for the presentation is as follows...</li>
                    <li>Up until now we've gone through the basics...</li>
                    <li>Then we are going more into details.... with, something called mapping...</li>
                    <li>Finally we are going to explain the workshop tasks</li>
                </ul>
                NOR:
                <ul>
                    <li>Agendaen for presentasjonen er som følger...</li>
                </ul>
            </aside>
        </section>

        <section>
            <section>
                <h2>How does a search engine work?</h2>
                <aside class="notes">
                    NOR:
                    <ul>
                        <li>
                            Hvordan fungerer en søkemotor?
                        </li>
                    </ul>
                </aside>
            </section>

            <section data-background="images/overflow2.jpg">
                <blockquote class="background-image-overlay">
                    Your document collection is big! <br />
                    Scan through all the documents every time you search for something?
                </blockquote>
                <aside class="notes">
                    ENG:
                    <ul>
                        <li>
                            This would have taken forever...
                        </li>
                    </ul>
                    NOR:
                    <ul>
                        <li>
                            Dette ville tatt evigheter...
                        </li>
                    </ul>
                </aside>
            </section>

            <section data-background="images/kokeboka4.png">
                <blockquote class="background-image-overlay">
                    Pre-process the documents and create an index!
                </blockquote>
                <aside class="notes">
                    ENG:
                    <ul>
                        <li>
                            Therefore, to make your search efficient/fast, a search engine will pre-process the documents and make a index
                        </li>
                    </ul>
                    NOR:
                    <ul>
                        <li>
                            For å gjøre dine søk raskt og effektivt vil en søkemotor forhåndsbehandle dokumentene og lage en index
                        </li>
                    </ul>
                </aside>
            </section>

            <section data-background="white">
                <h2>Create an inverted index</h2>
                <img style="box-shadow: none;" data-src="images/inverted-index-1.svg">
                <aside class="notes">
                    ENG:
                    <ul>
                        <li>You make something called an "inverted index"</li>
                        <li>On the left side we have three documents ...</li>
                        <li>What happens is that we create an "inverted index" of these documents (the documents are indexed, as it is called)
                        </li>
                        <li>An inverted index (which we see on the right side here now) contain all the words contained in the documents,
                            and for every word, we list up which documents containing the word...
                        </li>
                        <li>So the word "pizza" is found in document 0 and 2</li>
                    </ul>
                    NOR:
                    <ul>
                        <li>Man lager seg da noe som heter en "invertert index"</li>
                        <li>På venstre siden har vi tre dokumenter...</li>
                        <li>Siden dette er en BigOne konferanse, så vil mye av innholdet i dag være pizza relatert...</li>
                        <li>Det som skjer er at man lager seg en invertert index av disse dokumentene (dokumentene blir
                            indeksert, som det heter)
                        </li>
                        <li>En invertert index (som vi ser på høyre side her nå) inneholder alle ordene som finnes i dokumentene, og for hvert ord så
                            lister man opp hvilke dokumenter som inneholder ordet...
                        </li>
                        <li>Så ordet "pizza" finnes i dokument 0 og 2</li>
                    </ul>
                </aside>
            </section>

            <section data-background="white">
                <h2>Find unique words</h2>
                <img style="box-shadow: none;" data-src="images/inverted-index-2.svg">
                <aside class="notes">
                    ENG:
                    <ul>
                        <li>
                            So how do you find unique words?
                            <ul>
                                <li>
                                    If we take the document "Turles loves pizza" as an example, it will go through different steps ...
                                    <ul>
                                        <li>You split the document into words</li>
                                        <li>You lowercase all words</li>
                                        <li>One finds basic stems (grunnstammer) for words, eg "loves" will become "love"</li>
                                    </ul>
                                </li>
                                <li>
                                    This is a simplified example ...
                                </li>
                            </ul>
                        </li>
                    </ul>
                    NOR:
                    <ul>
                        <li>
                            Så hvordan finner man unike ord?
                            <ul>
                                <li>
                                    Hvis man f.eks tar for seg dokumentet "Turles loves pizza", så vil det gå igjennom forskjellige steg...
                                    <ul>
                                        <li>Man splitter opp dokumentet i ord</li>
                                        <li>Man gjør alle bokstaver små</li>
                                        <li>Man finner grunnstammer for ord, f.eks "Loves" blir "love"</li>
                                    </ul>
                                </li>
                                <li>
                                    Dette er ett forenklet eksempel...
                                </li>
                            </ul>
                        </li>
                    </ul>
                </aside>
            </section>

            <section data-background="white">
                <h2>Search against the inverted index</h2>
                <img style="box-shadow: none;" data-src="images/inverted-index-3.svg">
            </section>

            <section data-background="white">
                <h2>Sort by relevance</h2>

                <p>How well each document matches the query</p>
                <img style="box-shadow: none;" data-src="images/inverted-index-4.svg">
                <aside class="notes">
                    ENG:
                    <ul>
                        <li>The document "I love my turles" contains both words, so it will be listed first.</li>
                    </ul>
                    NOR:
                    <ul>
                        <li>Dokumentet ""I love my turles" inneholder begge ordene, så det vil bli listet opp først. Få høyest score.</li>
                    </ul>
                </aside>
            </section>
        </section>

        <section data-background="white">
            <img style="box-shadow: none;" data-src="images/introduction.svg">
            <aside class="notes">
                ENG:
                <ul>
                    <li>I will now spend approximately one minute to say what Elasticsearch is.
                        <ul>
                            <li>
                                Lucene
                                <ul>
                                    <li>Cumbersome to use directly</li>
                                    <li>Provides few features for scaling past a single machine</li>
                                </ul>
                            </li>
                            <li>
                                Real time
                                <ul>
                                    <li>Indexing of documents if very fast</li>
                                    <li>Data is available for search almost immediately after indexing</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
                NOR:
                <ul>
                    <li>Jeg skal nå bruke sirka 1 minutt på å si hva Elasticsearch er.
                        <ul>
                            <li>
                                Lucene
                                <ul>
                                    <li>Cumbersome to use directly</li>
                                    <li>Provides few features for scaling past a single machine</li>
                                </ul>
                            </li>
                            <li>
                                Real time
                                <ul>
                                    <li>Det går fort å indeksere dokumenter</li>
                                    <li>Data er tilgjenglig for søk nesten med en gang etter indeksering</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </aside>
        </section>

        <section>
            <section>
                <h2>Use Cases</h2>
                <h5>What can Elasticsearch be used for?</h5>
            </section>

            <section>
                <h2>For Big Data</h2>
                <p>
                    Github uses Elasticsearch to search 20TB data, including 1.3 billion files and 130 billion code
                    lines
                </p>
                <aside class="notes">
                    Relationship databases:
                    <ul>
                        <li>This works well with smaller data sets, but is not very scalable</li>
                        <li>When the volume goes up, performance down (write operations)</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h2>Text search</h2>

                <p>With filtering, aggregations, highlightning, pagination...</p>
                <img data-src="images/github2.png"/>
            </section>

            <section>
                <h2>Pure Analytics</h2>

                <p>Count things and summarize your data, lots of data, often on timestamped data!</p>
                <img data-src="images/analytics.jpg"/>
            </section>

            <section>
                <h2>Centralized Logging</h2>

                <p>Logs > Logstash > Elasticsearch > Kibana</p>
                <img data-src="images/elk.png"/>
                <aside class="notes">
                    <ul>
                        <li>One example of anlaytics is the ELK stack</li>
                        <li>Lets say you have several applications running on different servers,
                            and you want to show its logs in a common place</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h2>Geolocation</h2>
                <img data-src="images/fouraquare.png"/>
            </section>

        </section>

				<section>
            <section>
                <h2>Own experience with Elasticsearch</h2>
            </section>

            <section data-background="images/kokeboka4.png">
                 <aside class="notes">
                     ENG:
                     <ul>
                         <li>The reason I wanted to learn about search engines were...</li>
                        <li>I have large collected on food recipes ...</li>
                        <li>And gradually it has become very many food recipes, nearly 400 pages ...</li>
                        <li>That makes it almost impossible to find what you search for ...</li>
                        <li>Eg I want to find all the main dishes containing chicken ...</li>
                     </ul>
                     NOR:
                    <ul>
                        <li>
                            Grunnen til at jeg ønsket å lære meg om søkemotorer var...
                        </li>
                        <li>
                            At jeg lenge har samlet på mat oppskrifter...
                        </li>
                        <li>
                            Og etter hvert har det blitt veldig mange mat oppskrifter, nesten 400 sider...
                        </li>
                        <li>
                            Som gjør at det nesten er umulig å finne det man søke etter...
                        </li>
                        <li>
                            F.eks jeg ønsker å finne alle hovedretter som inneholder kylling...
                        </li>
                    </ul>
                </aside>
            </section>

            <section>
                <h2>Alt Mulig Mat</h2>
                <ul>
                    <li>Text based searching</li>
                    <li>Structured searching (get all "Dessert" recipes)</li>
                </ul>
                <a href="https://altmuligmat.no" target="_blank"><img data-src="images/altmuligmat.png"/></a>
            </section>

            <section>
                <h2>How to use Elasticsearch?</h2>

                <p>Commonly used in addition to another database...</p>
                <img height="350" data-src="images/overview.png"/>
            </section>
        </section>

        <section>
            <section>
                <h2>How to get started with Elasticsearch?</h2>
                <aside class="notes">
                    <ul>
                        <li>Så hvordan kan man komme igang med Elasticsearch...</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h2>It is that easy</h2>
                <ul>
                    <li>Download Elasticsearch from www.elastic.co</li>
                    <li>Elasticsearch only requires Java to run</li>
                </ul>
                <pre><code class="hljs" data-trim contenteditable>
wget https://download.elasticsearch.org/elasticsearch/release/...
tar -zxvf elasticsearch-2.2.0.tar.gz
cd elasticsearch-2.2.0/bin
./elasticsearch.sh
                </code></pre>
            </section>

            <section>
                <h2>Zero configurations</h2>
                <ul>
                    <li>Elasticsearch just works
                        <ul>
                            <li>No configuration is needed</li>
                            <li>It has sensible defaults settings</li>
                        </ul>
                    </li>
                </ul>
                <aside class="notes">
                    It is easy to get started with Elasticsearch!
                </aside>
            </section>

            <section>
                <h2>Is Elasticsearch alive?</h2>

                <p>You can access it at http://localhost:9200 on your web browser, which returns this:</p>
                <pre class="fragment"><code class="hljs" data-trim contenteditable>
{
   "status":200,
   "name":"Cypher",
   "cluster_name":"elasticsearch",
   "version":{
      "number":"1.5.2",
      "build_hash":"62ff9868b4c8a0c45860bebb259e21980778ab1c",
      "build_timestamp":"2015-04-27T09:21:06Z",
      "build_snapshot":false,
      "lucene_version":"4.10.4"
   },
   "tagline":"You Know, for Search"
}
                </code></pre>
            </section>

            <section>
                <h2>REST API</h2>

                <ul>
                    <li>Elasticsearch hides the complexities of Lucene behind a REST API
                    <ul>
                        <li>POST (create)</li>
                        <li>GET (read)</li>
                        <li>PUT (update)</li>
                        <li>DELETE (delete)</li>
                    </ul>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>If you have not worked with REST API before...</li>
                        <li>POST, GET, PUT, DELTE is HTTP verbs...</li>
                        <li>With represents create, read, update and delete operations (CRUD)</li>
                    </ul>
                </aside>
            </section>

            <section>
                <h2>CURL works just fine!</h2>
                <img height="300" data-src="images/crud.png"/>
                <ul>
                     <li>An index is like a database</li>
                     <li>An type is like a SQL table</li>
                 </ul>
            </section>

            <section>
                <h2>What is stored in Elasticsearch?</h2>

                <p>JSON documents!</p>
                <pre class="json"><code class="hljs" data-trim contenteditable>
{
   "title": "Elasticsearch Worshop",
   "date": "2016-04-08"
}
                </code></pre>
            </section>

            <section>
                <h2>Let's do an example - A book website</h2>
                <ul>
                    <li>We are building a website to find books</li>
                    <li>We have a collection of books
                        <br />
                        <img height="200" data-src="images/the-pragmatic-programmer.jpg" />
                        <img height="200" data-src="images/clean-code.jpg" />
                        <img height="200" data-src="images/working-effectively-with-legacy-code.jpg" />
                    </li>
                    <li>We want simple text based searching</li>
                </ul>
            </section>

            <section>
                <h2>How to store the books?</h2>

                <p>The act of storing data in Elasticsearch is called indexing.</p>
                <pre><code class="hljs" data-trim contenteditable>
$curl -X POST localhost:9200/books/computer/1 --data
'{
    "name": "The Pragmatic Programmer",
    "category": "Programming",
    "price": 29.90
}'

$curl -X POST localhost:9200/books/computer/2 --data
'{ 
    "name": "Clean Code",
    "category": "Programming",
    "price": 14.90
}'

$curl -X POST localhost:9200/books/computer/3 --data
'{
    "name": "Working Effectively with Legacy Code",
    "category": "Refactoring",
    "price": 45.50
}'
                </code></pre>
                <aside class="notes">
                    It is much like the INSERT keyword in SQL except that, if the document already exists, the new
                    document would replace the old. The second part indicates on which index (an index could be compared to an SQL database, though I
                    don’t like this comparison) your query will be performed, and what is the type (a type could be
                    compared to an SQL table, though I don’t like this comparison either) of the document. From now, I
                    will write indices and types in orange

<!--
curl -X POST localhost:9200/books/computer/1 --data '{ "name": "The Pragmatic Programmer", "category": "Programming", "price": 29.90}'
curl -X POST localhost:9200/books/computer/2 --data '{ "name": "Clean Code", "category": "Programming", "price": 14.90}'
curl -X POST localhost:9200/books/computer/3 --data '{ "name": "Working Effectively with Legacy Code", "category": "Refactoring", "price": 45.50}'
-->
                </aside>
            </section>

            <section>
                <h2>Get</h2>
                <pre><code class="hljs" data-trim contenteditable>
                    $curl -X GET localhost:9200/books/computer/1
                </code></pre>
                <p>Result:</p>
                <pre><code class="hljs" data-trim contenteditable>
{
   "_index": "books",
   "_type": "computer",
   "_id": "1",
   "_version": 2,
   "found": true,
   "_source": {
      "name": "The Pragmatic Programmer",
      "category": "Programming",
      "price": 29.9
  }
}
                </code></pre>
            </section>

            <section>
                <h2>Update</h2>
                <pre><code class="hljs" data-trim contenteditable>
$curl -X PUT localhost:9200/books/computer/1 --data
'{
   "name":"The Awesome Programmer"
}'
                </code></pre>
                <p>Result:</p>
               <pre><code class="hljs" data-trim contenteditable>
{
   "_index":"books",
   "_type":"computer",
   "_id":"1",
   "_version":2,
   "created":false
}
               </code></pre>
            </section>


            <section>
                <h2>Delete</h2>
                <pre><code class="hljs" data-trim contenteditable>
                    $curl -X DELETE localhost:9200/books/computer/1
                </code></pre>
            </section>

            <section>
                <h2>So far</h2>
                <ul>
                    <li>All we have is NoSQL document store which is
                        <ul>
                            <li>Fast</li>
                            <li>Scalable</li>
                            <li>Easy to use</li>
                        </ul>
                    </li>
                    <li>Now to the really cool part, full-text search...</li>
                </ul>
            </section>

            <section>
                <h2>Full-text search</h2>
                <p>Find all books that contains the word "code"</p>
                <pre><code class="hljs" data-trim contenteditable>
                    $curl -X GET localhost:9200/books/computer/_search?q=code
                </code></pre>
            </section>

            <section>
                <h2>Full-text search - Result</h2>
                <p>Sorted by relevance!</p>
                <pre class="json"><code class="hljs" data-trim contenteditable>
{
   "took":6,
   "timed_out":false,
   "_shards":{
      "total":5,
      "successful":5,
      "failed":0
   },
   "hits":{
      "total":2,
      "max_score":0.15342641,
      "hits":[
         {
            "_index":"books",
            "_type":"computer",
            "_id":"2",
            "_score":0.15342641,
            "_source":{
               "name":"Clean Code",
               "category":"Programming",
               "price":14.9
            }
         },
         {
            "_index":"books",
            "_type":"computer",
            "_id":"3",
            "_score":0.11506981,
            "_source":{
               "name":"Working Effectively with Legacy Code",
               "category":"Refactoring",
               "price":45.5
            }
         }
      ]
   }
}
                </code></pre>
            </section>

        </section>

				<section>
					<section>
						<h2>Mapping</h2>
					</section>

					<section>
						<h2>What is mapping?</h2>
						<p>
							Mapping is used to define how a document, and the fields it contains, are stored and indexed.
						</p>
						<p>
							This is similar to a database schema.
						</p>
					</section>

					<section>
						<h2>Mapping example</h2>
						<p>Define the data types of the document fields</p>
						<pre><code class="hljs" data-trim contenteditable>
{
  "mappings": {
    "book": {
      "properties": {
        "name": {
          "type": "string"
        },
        "category": {
          "type": "string",
          "index": "not_analyzed"
        },
        "price": {
          "type": "float"
        }
      }
    } 
  }
}
                </code></pre>
					</section>
				</section>

				<section>
					<section>
						<h2>Queries and filters</h2>
					</section>

					<section>
						<h2>Query DSL</h2>

                        <ul>
                            <li>Alternative way of building queries</li>
                            <li>Allows us to build queries using JSON</li>
                        </ul>
					</section>

					<section>
						<h2>Full-text query</h2>

                        <p>Find the books with a name that contains the word "code"</p>
                        <pre><code class="hljs" data-trim contenteditable>
                            $ curl -XGET ‘localhost:9200/books/book/_search’ -d
'{
  "query": {
    "match": {
      "name": "code"
    }
  }
}'
                        </code></pre>
					</section>

					<section>
						<h2>Term query</h2>

                        <p>Find books belonging to the "Programming" category</p>
                        <pre><code class="hljs" data-trim contenteditable>
{
  "query": {
    "term": {
      "category": "Programming"
    }
  }
}
                        </code></pre>
					</section>

					<section>
						<h2>Filter</h2>

                        <p>Find books belonging to the "Programming" category, while skipping relevance scoring</p>
                        <pre><code class="hljs" data-trim contenteditable>
{
  "query": {
    "bool": {
      "filter": [
        { "term": { "category": "Programming" } }
      ]
    }
  }
}
                        </code></pre>
					</section>

					<section>
						<h2>Query vs Filter</h2>

                        <table>
                            <thead>
                            <tr>
                                <th>Query</th>
                                <th>Filter</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>Full text search</td>
                                <td>Exact match</td>
                            </tr>
                            <tr>
                                <td>Relevance scoring</td>
                                <td>Binary yes/no</td>
                            </tr>
                            <tr>
                                <td>Relatively slow</td>
                                <td>Fast</td>
                            </tr>
                            <tr>
                                <td>Not cacheable</td>
                                <td>Cacheable</td>
                            </tr>
                            </tbody>
                        </table>
					</section>

                    <section>
                        <h2>Choosing between query and filter</h2>

                        <ul>
                            <li>Use queries for full-text search, or for cases where you want a relevance score</li>
                            <li>Use filters for everything else</li>
                        </ul>

                        <p>Or combine them: Filter first, then query remaining docs.</p>
                    </section>

                </section>

				<section>
					<section>
						<h2>Aggregations</h2>
					</section>

					<section>
						<ul>
							<li>Used to perform analysis on the data</li>
							<li>Broken into 3 "families"</li>
							<ul>
								<li>Metric</li>
								<li>Bucket</li>
								<li>Pipeline</li>
							</ul>
						</ul>
					</section>

					<section>
						<table>
							<thead>
							<tr>
								<th>Metric</th>
								<th>Bucket</th>
							</tr>
							</thead>
							<tbody>
								<tr>
									<td>Min</td>
									<td>Range</td>
								</tr>
								<tr>
									<td>Max</td>
									<td>Terms</td>
								</tr>
								<tr>
									<td>Sum</td>
									<td>Histogram</td>
								</tr>
								<tr>
									<td>Avg</td>
									<td></td>
								</tr>
								<tr>
									<td>Stats</td>
									<td></td>
								</tr>
							</tbody>
						</table>
					</section>
					<section>
						<h2>Buckets</h2>
						<h5>Range</h5>
						<table>
							<tr>
								<td width="550px">
									<pre><code data-trim data-noescape>
...
"aggs" : {
  "price_ranges" : {
    "range" : {
      "field" : "price",
      "ranges" : [
        { "to" : 10 },
        { "from" : 10, "to" : 30 },
        { "from" : 30 }
      ]
    }
  }
}
...
									</code></pre>
								</td>
								<td width="350px">
									<pre><code data-trim>
...
"buckets": {
  "*-10.0": {
    "to": 10,
    "doc_count": 0
  },
  "10.0-30.0": {
    "from": 10,
    "to": 30,
    "doc_count": 2
  },
  "30.0-*": {
    "from": 30,
    "doc_count": 1
  }
}
...
									</code></pre>
								</td>
							</tr>
						</table>
					</section>
					<section>
						<h2>Buckets</h2>
						<h5>Histogram</h5>
						<table>
							<tr>
								<td width="350px">
									<pre><code data-trim>
...
"aggs" : {
  "prices" : {
    "histogram" : {
      "field" : "price",
      "interval" : 15
    }
  }
}
...
									</code></pre>
								</td>
								<td width="350px" height="900px">
									<pre><code data-trim >
...
"prices" : {
  "buckets": [
    {
      "key": 0,
      "doc_count": 1
    },
    {
      "key": 15,
      "doc_count": 1
    },
    {
      "key": 30,
      "doc_count": 0
    },
    {
	  "key": 45,
	  "doc_count": 1
	}
    ]
  }
}
...
									</code></pre>
								</td>
							</tr>
						</table>
					</section>
					<section>
						<h2>Buckets</h2>
						<h5>Terms</h5>
						<table>
							<tr>
								<td width="350px">
									<pre><code data-trim>
...
"aggs" : {
  "categories" : {
    "terms" : {
      "field" : "category"
    }
  }
}
...									</code></pre>
								</td>
								<td width="350px">
									<pre><code data-trim>
...
"buckets": [
  {
    "key": "programming",
    "doc_count": 2
  },
  {
    "key": "refactoring",
    "doc_count": 1
  }
...
										</code></pre>
									</td>
								</tr>
							</tbody>
						</table>
					</section>
					<section>
						<h2>Metrics</h2>
						<h5>Min</h5>
						<table>
							<tbody>
								<tr>
									<td width="400px">
										<pre><code data-trim>
...
"aggs" : {
  "min_price" : {
    "min" : {
     "field" : "price"
    }
  }
}
...
										</code></pre>
									</td>
									<td width="300px">
										<pre><code data-trim>
...
"aggregations": {
  "min_price": {
    "value": 14.9
  }
}
...
										</code></pre>
									</td>
								</tr>
							</tbody>
						</table>
					</section>
					<section>
						<h2>Metrics</h2>
						<h5>Avg</h5>
						<table>
							<tbody>
								<tr>
									<td width=400px>
										<pre><code data-trim>
...
"aggs" : {
  "avg_price" : {
    "avg" : {
      "field" : "price"
    }
  }
}
...
										</code></pre>
									</td>
									<td width=300px>
										<pre><code data-trim>
...
"aggregations": {
  "avg_price": {
    "value": 30.099999999999998
  }
}
...
										</code></pre>
									</td>
								</tr>
							</tbody>
						</table>
					</section>
					<section>
						<h2>Metrics</h2>
						<h5>Stats</h5>
						<table>
							<tbody>
								<tr>
									<td width=400px>
										<pre><code data-trim>
...
"aggs" : {
  "price_stats" : {
    "stats" : {
      "field" : "price"
    }
  }
}
...
										</code></pre>
									</td>
									<td width=300px>
										<pre><code data-trim>
...
"aggregations": {
  "prices_stats": {
    "count": 3,
    "min": 14.9,
    "max": 45.5,
    "avg": 30.099999999999998,
    "sum": 90.3
  }
}
...
										</code></pre>
									</td>
								</tr>
							</tbody>
						</table>
					</section>
				</section>
				<section>
					<section>
						<h2>Highlighting</h2>
					</section>
					<section>
						<table>
							<tbody>
								<tr>
									<td width=400px>
										<pre><code data-trim>
{
  "query": {
    "match": {
      "name": "legacy code"
    }
  },
  "highlight": {
    "fields": {
      "name": {}
    }
  }
}
										</code></pre>
									</td>
									<td width=500px>
										<pre><code data-trim>
...
"highlight": {
  "name": [
  "Working Effectively with
   <em>Legacy</em> <em>Code</em>"
   ]
}
...
"highlight": {
  "name": [
  "Clean <em>Code</em>"
  ]
}
...
										</code></pre>
									</td>
								</tr>
							</tbody>
						</table>
					</section>
				</section>
				<section>
					<section>
						<h2>Workshop</h2>
					</section>

					<section>
						<h2>What will you learn?</h2>
                        <p>19 tasks - learning Query DSL</p>
						<ul>
                            <li>Intro task - match all (task 0) </li>
							<li>Full-text search (task 1-4)</li>
							<li>Term queries (task 5-8)</li>
							<li>Aggregations (task 9-13)</li>
                            <li>Combine full-text search and aggregations (task 14)</li>
							<li>Sorting (task 15)</li>
							<li>Highlighting (task 16)</li>
							<li>Pagination (task 17-18)</li>
							</li>
						</ul>
					</section>

                    <section>
                        <h2>List of pizzas</h2>
                        <p>The data that are used during the workshop is a list of <a href="https://github.com/WorkshopDudes/elasticsearch-workshop/blob/master/data.json" target="_blank">pizzas</a>, with the <a href="https://github.com/WorkshopDudes/elasticsearch-workshop/blob/master/mapping.json" target="_blank">mapping</a></p>
                    </section>

					<section>
						<h2>Tasks look like this</h2>
						<pre><code>
Feature: Topic of the task

 // Use https://www.elastic.co/guide/en/...

 Scenario: Description of the task
  Given all pizzas are indexed
  When I make a query
  """
  { todo }
  """
  Then the response should contain
  """
  { subset }
  """
						</code></pre>
						<ul>
							<li>Your task is to replace the `{ todo }` with the correct query
                            </li>
							<li>A query needs to return a correct response { subset } to be passed</li>
						</ul>
					</section>

                    <section>
                        <h2>Known issues - A query need to be correctly aligned</h2>

                        <div class='left' style='float:left;width:48%'>
							<p>Correct</p>
							<pre><code>
  When I make a query
  """
  {
    ...
  }
  """
							</code></pre>
						</div>
						<div class='right' style='float:right;width:48%'>
							<p>Wrong</p>
							<pre><code>
 When I make a query
  """{
    ...
}
  """
							</code></pre>
						</div>
                    </section>

                    <section>
                        <h2>Known issues - Tab in windows is causing trouble</h2>
                        <ul>
                            <li>Please use spaces instead of tab for indentations</li>
                        </ul>
                    </section>

					<section>
						<h2>Compare against subsets</h2>

						<div class='left' style='float:left;width:48%'>
							<p>Total</p>
							<pre><code>
{
   "workshop": "Elasticsearch",
   "date" : "2016-04-08"
}
							</code></pre>
						</div>
						<div class='right' style='float:right;width:48%'>
							<p>Subset</p>
							<pre><code>
{
   "date" : "2016-04-08"
}
							</code></pre>
						</div>
					</section>

					<section>
						<h2>Running</h2>
						<ul>
							<li>Manual installation
								<ul>
									<li> Windows: `run-tasks.cmd`</li>
									<li> Linux: `./run-tasks.sh`</li>
								</ul>
							</li>
							<li>Docker
								<ul>
									<li>make run-tasks</li>
								</ul>
							</li>
						</ul>
					</section>

					<!--<section>
						<img data-src="images/tasks.png" />
					</section>-->
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
